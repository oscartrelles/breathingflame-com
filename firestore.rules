rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow public read access to all content collections
    match /settings/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /navigation/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /home/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /programs/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /experiences/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /posts/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /testimonials/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /caseStudies/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /eventsPinned/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /pageIndividuals/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    match /pageOrganizations/{document} {
      allow read: if true;
      allow write: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
    }
    
    // Contact form submissions - authenticated function writes only
    match /contactSubmissions/{document} {
      allow read: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
      allow write: if false; // Only functions can write
    }
    
    // Newsletter signups - authenticated function writes only
    match /newsletterSignups/{document} {
      allow read: if request.auth != null && 
        (request.auth.token.role == 'admin' || request.auth.token.role == 'editor');
      allow write: if false; // Only functions can write
    }
    
    // Analytics and tracking data - read only for admins
    match /analytics/{document} {
      allow read: if request.auth != null && request.auth.token.role == 'admin';
      allow write: if false; // Only functions can write
    }
    
    // User preferences and sessions - user-specific access
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Admin and editor roles - admin only access
    match /roles/{document} {
      allow read: if request.auth != null && request.auth.token.role == 'admin';
      allow write: if request.auth != null && request.auth.token.role == 'admin';
    }
  }
}

